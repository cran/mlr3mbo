<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>mlr3mbo</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">mlr3mbo</h1>
<h3 class="subtitle">Flexible Bayesian Optimization in R</h3>



<div id="intro" class="section level1">
<h1>Intro</h1>
<p><a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> makes Bayesian
Optimization (BO) available within the <a href="https://mlr3.mlr-org.com">mlr3</a> ecosystem. BO can be used for
optimizing any black box function, and is very suitable for
hyperparameter optimization of machine learning models. <a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> allows for building
custom BO algorithms relying on building blocks in a modular fashion,
but also provides a variety of standard single- and multi-objective BO
algorithms that can be used in a straightforward manner.</p>
<p>We assume that the reader is somewhat familiar with black box
optimization and <a href="https://bbotk.mlr-org.com">bbotk</a>,
hyperparameter optimization and <a href="https://mlr3tuning.mlr-org.com">mlr3tuning</a> and knows the
basics of BO. Background material is, for example, given by <span class="citation">Garnett (2022)</span>, <span class="citation">Bischl,
Binder, et al. (2023)</span>, and <span class="citation">Bischl,
Sonabend, et al. (2023)</span>.</p>
</div>
<div id="building-blocks" class="section level1">
<h1>Building Blocks</h1>
<p>BO is an iterative optimization algorithm that makes use of a
so-called surrogate to model the unknown black box function. After
having observed an initial design of observations, the surrogate model
is trained on all data points observed so far and an acquisition
function is used to determine which points of the search space are
promising candidates that should be evaluated next. The acquisition
function relies on the prediction of the surrogate model and requires no
evaluation of the true black box function and therefore is comparably
cheap to optimize. After having evaluated the next candidate, the
process repeats itself until a given termination criteria is met.</p>
<p>Most BO flavors therefore follow a simple loop:</p>
<ol style="list-style-type: decimal">
<li>Fit the surrogate on all observations made so far.</li>
<li>Optimize the acquisition function to find the next candidate that
should be evaluated.</li>
<li>Evaluate the next candidate.</li>
</ol>
<p>In the following, the basic building blocks of BO and their
implementation in <a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> are
introduced in more detail.</p>
<div id="loop-function" class="section level2">
<h2>Loop Function</h2>
<p>The <a href="https://mlr3mbo.mlr-org.com/reference/loop_function.html"><code>loop_function</code></a>
determines the behavior of the BO algorithm on a global level, i.e., how
the subroutine should look like that is performed at each iteration.</p>
<p>To get an overview of readily available <code>loop_function</code>s,
the following dictionary can be inspected:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(mlr3mbo)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_loop_functions)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt;                key                         label    instance</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#&gt; 1:    bayesopt_ego Efficient Global Optimization single-crit</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#&gt; 2:    bayesopt_emo           Multi-Objective EGO  multi-crit</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#&gt; 3:   bayesopt_mpcl      Multipoint Constant Liar single-crit</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt; 4: bayesopt_parego                        ParEGO  multi-crit</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt; 5: bayesopt_smsego                       SMS-EGO  multi-crit</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt;                                   man</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt; 1:    mlr3mbo::mlr_loop_functions_ego</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt; 2:    mlr3mbo::mlr_loop_functions_emo</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#&gt; 3:   mlr3mbo::mlr_loop_functions_mpcl</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#&gt; 4: mlr3mbo::mlr_loop_functions_parego</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt; 5: mlr3mbo::mlr_loop_functions_smsego</span></span></code></pre></div>
<p>The dictionary shows the <code>key</code>, i.e., ID of the
<code>loop_function</code>, a brief description, for which optimization
instance the resulting BO flavor can be used, as well as how
documentation can be accessed.</p>
<p>Technically, all <code>loop_function</code>s are members of the
<code>S3</code> class <a href="https://mlr3mbo.mlr-org.com/reference/loop_function.html"><code>loop_function</code></a>,
and are simply decorated <a href="https://www.rdocumentation.org/packages/base/topics/function"><code>functions</code></a>
(because using an <a href="https://www.rdocumentation.org/packages/R6/topics/R6Class"><code>R6Class</code></a>
class would be over the top here - but this may change in the
future).</p>
<p>To write an own <code>loop_function</code>, users can get inspiration
from the readily available ones, e.g., <a href="https://mlr3mbo.mlr-org.com/reference/mlr_loop_functions_ego.html"><code>bayesopt_ego</code></a>
which performs sequential single-objective optimization:</p>
<p>After having made some assertions and safety checks, and having
evaluated the initial design, <code>bayesopt_ego</code> essentially only
performs the following steps:</p>
<ol style="list-style-type: decimal">
<li><code>acq_function$surrogate$update()</code> # update the surrogate
model</li>
<li><code>acq_function$update()</code> # update the acquisition function
(e.g., update the best value observed so far)</li>
<li><code>acq_optimizer$optimize()</code> # optimize the acquisition
function to yield a new candidate</li>
</ol>
</div>
<div id="surrogate" class="section level2">
<h2>Surrogate</h2>
<p>A surrogate encapsulates a regression learner that models the unknown
black box function based on observed data. In <a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a>, <a href="https://mlr3mbo.mlr-org.com/reference/SurrogateLearner.html"><code>SurrogateLearner</code></a>
and <a href="https://mlr3mbo.mlr-org.com/reference/SurrogateLearnerCollection.html"><code>SurrogateLearnerCollection</code></a>
are the higher-level <code>R6</code> classes which should be used to
construct a surrogate, inheriting from the base <a href="https://mlr3mbo.mlr-org.com/reference/Surrogate.html"><code>Surrogate</code></a>
class.</p>
<p>As a learner, any <a href="https://mlr3.mlr-org.com/reference/LearnerRegr.html"><code>LearnerRegr</code></a>
from <a href="https://mlr3.mlr-org.com">mlr3</a> can be used, however,
most acquisition functions require both a mean and a variance prediction
(therefore not all learners are suitable for all scenarios). Typical
choices include:</p>
<ul>
<li>A <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.km.html"><code>Gaussian Process</code></a>
for low dimensional numeric search spaces</li>
<li>A <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.ranger.html"><code>Random Forest</code></a>
for higher dimensional mixed (and / or hierarchical) search spaces</li>
</ul>
<p>A <code>SurrogateLearner</code> can be constructed via:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; Loading required package: mlr3</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>surrogate <span class="ot">=</span> SurrogateLearner<span class="sc">$</span><span class="fu">new</span>(<span class="fu">lrn</span>(<span class="st">&quot;regr.km&quot;</span>))</span></code></pre></div>
<p>or using syntactic sugar:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>surrogate <span class="ot">=</span> <span class="fu">srlrn</span>(<span class="fu">lrn</span>(<span class="st">&quot;regr.km&quot;</span>))</span></code></pre></div>
<p>The encapsulated learner can be accessed via the
<code>$learner</code> field:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>surrogate<span class="sc">$</span>learner</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; &lt;LearnerRegrKM:regr.km&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; * Model: -</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; * Parameters: list()</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; * Packages: mlr3, mlr3learners, DiceKriging</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; * Predict Types:  response, [se]</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; * Feature Types: logical, integer, numeric</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; * Properties: -</span></span></code></pre></div>
<p>The surrogate itself has the following hyperparameters:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>surrogate<span class="sc">$</span>param_set</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt;                      id    class lower upper nlevels        default</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; 1: assert_insample_perf ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; 2:         catch_errors ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; 3:         perf_measure ParamUty    NA    NA     Inf &lt;NoDefault[3]&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; 4:       perf_threshold ParamDbl  -Inf   Inf     Inf &lt;NoDefault[3]&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt;                 parents value</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; 1:                      FALSE</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; 2:                       TRUE</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; 3: assert_insample_perf      </span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; 4: assert_insample_perf</span></span></code></pre></div>
<p><code>assert_insample_perf = TRUE</code> results in the insample
performance of the learner being calculated and asserted against a
performance threshold after each <code>$update()</code>. This requires
the specification of a <code>perf_measure</code> (any regression
measure, e.g., <a href="https://mlr3.mlr-org.com/reference/mlr_measures_regr.rsq.html"><code>R squared</code></a>)
and a <code>perf_threshold</code>. If the threshold is not met, an error
is thrown (that is caught within the optimization loop - unless
<code>catch_errors = FALSE</code> and results in, e.g., proposing the
next candidate uniformly at random). For more details on error handling,
see the <a href="#safety-nets">Safety Nets</a> section.</p>
<p>Note that this insample performance assertion is not always
meaningful, e.g., in the case of using a Gaussian Process with no
nugget, the insample performance will always be perfect.</p>
<p>Internally, the learner is fitted on a <a href="https://mlr3.mlr-org.com/reference/TaskRegr.html"><code>regression task</code></a>
constructed from the <a href="https://bbotk.mlr-org.com/reference/Archive.html"><code>Archive</code></a>
of the <a href="https://bbotk.mlr-org.com/reference/OptimInstance.html"><code>OptimInstance</code></a>
that is to be optimized and features and the target variable are
determined automatically but can also be specified via the
<code>$cols_x</code> and <code>$cols_y</code> active bindings. Ideally,
the <code>archive</code> is already passed during construction, however,
lazy initialization is also possible (i.e., the <code>$archive</code>
field will be automatically populated within the optimization routine of
an <a href="https://mlr3mbo.mlr-org.com/reference/mlr_optimizers_mbo.html"><code>OptimizerMbo</code></a>).</p>
<p>Important methods are <code>$update()</code> and
<code>$predict()</code> with the former one typically being used within
the <code>loop_function</code> and the latter one being used within the
implementation of an acquisition function.</p>
<p>Depending on the choice of the <code>loop_function</code>, multiple
targets must be modelled by (currently independent) surrogates, in which
case a <code>SurrogateLearnerCollection</code> should be used.
Construction and hyperparameters are analogous to the single target
scenario described above.</p>
<p>To get an overview of all available regression learners within the <a href="https://mlr3.mlr-org.com">mlr3</a> ecosystem, use:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co"># there are plenty of more in mlr3extralearners</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># library(mlr3extralearners)</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>learners <span class="ot">=</span> <span class="fu">as.data.table</span>(mlr_learners)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>learners[task_type <span class="sc">==</span> <span class="st">&quot;regr&quot;</span>]</span></code></pre></div>
<p>To use a custom learner not included in <a href="https://mlr3.mlr-org.com">mlr3</a>, <a href="https://mlr3learners.mlr-org.com">mlr3learners</a>, or <a href="https://mlr3extralearners.mlr-org.com">mlr3extralearners</a>, you
can inherit from <a href="https://mlr3.mlr-org.com/reference/LearnerRegr.html"><code>LearnerRegr</code></a>
and use this custom learner within the surrogate.</p>
</div>
<div id="acquisition-function" class="section level2">
<h2>Acquisition Function</h2>
<p>Based on a surrogate, an acquisition function quantifies the
attractiveness of each point of the search space if it were to be
evaluated in the next iteration.</p>
<p>A popular example is given by the Expected Improvement <span class="citation">(Jones, Schonlau, and Welch 1998)</span>:</p>
<p><span class="math display">\[
\mathbb{E} \left[ \max \left( f_{\mathrm{min}} - Y(\mathbf{x}), 0
\right) \right]
\]</span> Here, <span class="math inline">\(Y(\mathbf{x})\)</span> is
the surrogate prediction (a random variable) for a given point <span class="math inline">\(\mathbf{x}\)</span> (which when using a Gaussian
Process follows a normal distribution) and <span class="math inline">\(f_{\mathrm{min}}\)</span> is the currently best
function value observed so far (when assuming minimization).</p>
<p>To get an overview of available acquisition functions, the following
dictionary can be inspected:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_acqfunctions)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt;        key                                              label</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt;  1:    aei                     Augmented Expected Improvement</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt;  2:     cb                     Lower / Upper Confidence Bound</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt;  3:   ehvi                   Expected Hypervolume Improvement</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt;  4: ehvigh Expected Hypervolume Improvement via GH Quadrature</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt;  5:     ei                               Expected Improvement</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt;  6:   eips                    Expected Improvement Per Second</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt;  7:   mean                                     Posterior Mean</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt;  8:     pi                         Probability Of Improvement</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt;  9:     sd                       Posterior Standard Deviation</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; 10: smsego                                            SMS-EGO</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt;                                  man</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt;  1:    mlr3mbo::mlr_acqfunctions_aei</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt;  2:     mlr3mbo::mlr_acqfunctions_cb</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt;  3:   mlr3mbo::mlr_acqfunctions_ehvi</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt;  4: mlr3mbo::mlr_acqfunctions_ehvigh</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt;  5:     mlr3mbo::mlr_acqfunctions_ei</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt;  6:   mlr3mbo::mlr_acqfunctions_eips</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt;  7:   mlr3mbo::mlr_acqfunctions_mean</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt;  8:     mlr3mbo::mlr_acqfunctions_pi</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt;  9:     mlr3mbo::mlr_acqfunctions_sd</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt; 10: mlr3mbo::mlr_acqfunctions_smsego</span></span></code></pre></div>
<p>The dictionary shows the <code>key</code>, i.e., ID of the
acquisition function, a brief description, and how the documentation can
be accessed.</p>
<p>Technically, all acquisition functions inherit from the
<code>R6</code> class <a href="https://mlr3mbo.mlr-org.com/reference/AcqFunction.html"><code>AcqFunction</code></a>
which itself simply inherits from the base <a href="https://bbotk.mlr-org.com/reference/Objective.html"><code>Objective</code></a>
class.</p>
<p>Construction is straightforward via:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>acq_function <span class="ot">=</span> AcqFunctionEI<span class="sc">$</span><span class="fu">new</span>()</span></code></pre></div>
<p>or using syntactic sugar:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>acq_function <span class="ot">=</span> <span class="fu">acqf</span>(<span class="st">&quot;ei&quot;</span>)</span></code></pre></div>
<p>Internally, the <code>domain</code> and <code>codomain</code> are
constructed based on the <a href="https://bbotk.mlr-org.com/reference/Archive.html"><code>Archive</code></a>
referenced by the <a href="https://mlr3mbo.mlr-org.com/reference/Surrogate.html"><code>Surrogate</code></a>
and therefore the <code>surrogate</code> should be passed as an argument
already during construction.</p>
<p>However, lazy initialization is also possible.</p>
<p>In the case of the acquisition function itself being parameterized,
hyperparameters should be passed as constants, e.g.:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">acqf</span>(<span class="st">&quot;cb&quot;</span>) <span class="co"># lower / upper confidence bound with lambda hyperparameter</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; &lt;AcqFunctionCB:acq_cb&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; Domain:</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; Empty.</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; Codomain:</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; &lt;Codomain&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; Empty.</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; Constants:</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;        id    class lower upper nlevels default value</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; 1: lambda ParamDbl     0   Inf     Inf       2     2</span></span></code></pre></div>
<p>To use a custom acquisition function you should implement a new
<code>R6</code> class inheriting from <a href="https://mlr3mbo.mlr-org.com/reference/AcqFunction.html"><code>AcqFunction</code></a>.</p>
</div>
<div id="acquisition-function-optimizer" class="section level2">
<h2>Acquisition Function Optimizer</h2>
<p>To find the most promising candidate for evaluation, the acquisition
function itself must be optimized. Internally, an <a href="https://bbotk.mlr-org.com/reference/OptimInstance.html"><code>OptimInstance</code></a>
is constructed using the acquisition function as an <a href="https://bbotk.mlr-org.com/reference/Objective.html"><code>Objective</code></a>.</p>
<p>An acquisition function optimizer is then used to solve this
optimization problem. Technically, this optimizer is a member of the <a href="https://mlr3mbo.mlr-org.com/reference/AcqOptimizer.html"><code>AcqOptimizer</code></a>
<code>R6</code> class.</p>
<p>Construction requires specifying an <a href="https://bbotk.mlr-org.com/reference/Optimizer.html"><code>Optimizer</code></a>
as well as a <a href="https://bbotk.mlr-org.com/reference/Terminator.html"><code>Terminator</code></a>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">library</span>(bbotk)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt; Loading required package: paradox</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>acq_optimizer <span class="ot">=</span> AcqOptimizer<span class="sc">$</span><span class="fu">new</span>(<span class="fu">opt</span>(<span class="st">&quot;random_search&quot;</span>), <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>))</span></code></pre></div>
<p>Syntactic sugar:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>acq_optimizer <span class="ot">=</span> <span class="fu">acqo</span>(<span class="fu">opt</span>(<span class="st">&quot;random_search&quot;</span>), <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>))</span></code></pre></div>
<p>The optimizer and terminator can be accessed via the
<code>$optimizer</code> and <code>$terminator</code> fields:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>acq_optimizer<span class="sc">$</span>optimizer</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; &lt;OptimizerRandomSearch&gt;: Random Search</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; * Parameters: batch_size=1</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; * Parameter classes: ParamLgl, ParamInt, ParamDbl, ParamFct</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; * Properties: dependencies, single-crit, multi-crit</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; * Packages: bbotk</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>acq_optimizer<span class="sc">$</span>terminator</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; &lt;TerminatorEvals&gt;: Number of Evaluation</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; * Parameters: n_evals=100, k=0</span></span></code></pre></div>
<p>Internally, the acquisition function optimizer also requires the
acquisition function and therefore the <code>acq_function</code>
argument should be specified during construction.</p>
<p>However, lazy initialization is also possible.</p>
<p>An <a href="https://mlr3mbo.mlr-org.com/reference/AcqOptimizer.html"><code>AcqOptimizer</code></a>
has the following hyperparameters:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>acq_optimizer<span class="sc">$</span>param_set</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt;                        id    class lower upper nlevels        default   parents</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; 1:           catch_errors ParamLgl    NA    NA       2           TRUE          </span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; 2:          logging_level ParamFct    NA    NA       6           warn          </span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; 3: skip_already_evaluated ParamLgl    NA    NA       2           TRUE          </span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; 4:              warmstart ParamLgl    NA    NA       2          FALSE          </span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; 5:         warmstart_size ParamInt     1   Inf     Inf &lt;NoDefault[3]&gt; warmstart</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt;    value</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; 1:  TRUE</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt; 2:  warn</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt; 3:  TRUE</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt; 4: FALSE</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt; 5:</span></span></code></pre></div>
<p><code>catch_errors = TRUE</code> results in catching any errors that
can happen during the acquisition function optimization which allows
for, e.g., proposing the next candidate uniformly at random within the
<code>loop_function</code>. For more details on this mechanism, see the
<a href="#safety-nets">Safety Nets</a> section.
<code>logging_level</code> specifies the logging level during
acquisition function optimization. Often it is useful to only log the
progress of the BO loop and therefore <code>logging_level</code> is set
to <code>&quot;warn&quot;</code> by default. For debugging purposes, this should
be set to <code>&quot;info&quot;</code>.
<code>skip_already_evaluated = TRUE</code> will result in not proposing
candidates for evaluation that were already evaluated in previous
iterations. <code>warmstart = TRUE</code> results in the best
<code>warmstart_size</code> points present in the <code>archive</code>
of the <code>OptimInstance</code> to also be evaluated on the
acquisition function <code>OptimInstance</code> prior to running the
actual acquisition function optimization. This is especially useful in
the context of using evolutionary algorithms or variants of local search
as the acquisition function optimizer (as the current best points should
usually be part of the initial population to further optimize local
optima).</p>
<p>To get an overview of all <code>Optimizer</code>s implemented in <a href="https://bbotk.mlr-org.com">bbotk</a> you can use:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_optimizers)</span></code></pre></div>
<p>And similarly for <code>Terminator</code>s:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_terminators)</span></code></pre></div>
<p>Again, you can also use custom <code>Optimizer</code>s or
<code>Terminator</code>s by implementing new <code>R6</code> classes
inheriting from <a href="https://bbotk.mlr-org.com/reference/Optimizer.html"><code>Optimizer</code></a>
and <a href="https://bbotk.mlr-org.com/reference/Terminator.html"><code>Terminator</code></a>
respectively.</p>
</div>
</div>
<div id="putting-it-together" class="section level1">
<h1>Putting it Together</h1>
<p>Having introduced all building blocks we are now ready to put
everything together in the form of an <a href="https://mlr3mbo.mlr-org.com/reference/mlr_optimizers_mbo.html"><code>OptimizerMbo</code></a>
or <a href="https://mlr3mbo.mlr-org.com/reference/mlr_tuners_mbo.html"><code>TunerMbo</code></a>.</p>
<p><a href="https://mlr3mbo.mlr-org.com/reference/mlr_optimizers_mbo.html"><code>OptimizerMbo</code></a>
inherits from <a href="https://bbotk.mlr-org.com/reference/Optimizer.html"><code>Optimizer</code></a>
and requires a <code>loop_function</code>, <code>surrogate</code>,
<code>acq_function</code> and <code>acq_optimizer</code>.</p>
<p>Construction is performed via:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>optimizer <span class="ot">=</span> OptimizerMbo<span class="sc">$</span><span class="fu">new</span>(bayesopt_ego,</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span></code></pre></div>
<p>or using syntactic sugar:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>optimizer <span class="ot">=</span> <span class="fu">opt</span>(<span class="st">&quot;mbo&quot;</span>,</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="at">loop_function =</span> bayesopt_ego,</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>optimizer</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; &lt;OptimizerMbo&gt;: Model Based Optimization</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt; * Parameter classes: ParamLgl, ParamInt, ParamDbl</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; * Properties: single-crit</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; * Packages: mlr3mbo, mlr3, mlr3learners, DiceKriging, bbotk</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; * Loop function: bayesopt_ego</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt; * Surrogate: LearnerRegrKM</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt; * Acquisition Function: AcqFunctionEI</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt; * Acquisition Function Optimizer: (OptimizerRandomSearch |</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#&gt;   TerminatorEvals)</span></span></code></pre></div>
<p>Additional arguments, i.e., arguments of the
<code>loop_function</code> can be passed via the <code>args</code>
argument during construction or the <code>$args</code> active binding.
Finally, the mechanism how the final result is obtained after the
optimization process (i.e., the best point in the case of
single-objective and the Pareto set in the case of multi-objective
optimization) can be changed via the <code>result_assigner</code>
argument during construction or the <code>$result_assigner</code> active
binding. As an example, <a href="https://mlr3mbo.mlr-org.com/reference/mlr_result_assigners_surrogate.html"><code>ResultAssignerSurrogate</code></a>
will choose the final solution based on the prediction of the surrogate
instead of the evaluations logged in the <code>archive</code> which is
sensible in the case of noisy objective functions. The default, however,
is to use <a href="https://mlr3mbo.mlr-org.com/reference/mlr_result_assigners_archive.html"><code>ResultAssignerArchive</code></a>
which will directly choose the final solution based on the evaluations
logged in the <code>archive</code>. To get an overview of available
result assigners, the following dictionary can be inspected:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_result_assigners)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co">#&gt;          key                     label                                     man</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co">#&gt; 1:   archive                   Archive   mlr3mbo::mlr_result_assigners_archive</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co">#&gt; 2: surrogate Mean Surrogate Prediction mlr3mbo::mlr_result_assigners_surrogate</span></span></code></pre></div>
<p>The dictionary shows the <code>key</code>, i.e., ID of the result
assigner, a brief description, and how the documentation can be
accessed.</p>
<p>Construction of result assigners is straightforward:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>result_assigner <span class="ot">=</span> ResultAssignerArchive<span class="sc">$</span><span class="fu">new</span>()</span></code></pre></div>
<p>Syntactic sugar:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>result_assigner <span class="ot">=</span> <span class="fu">ras</span>(<span class="st">&quot;archive&quot;</span>)</span></code></pre></div>
<p>Note that important fields of an <code>OptimizerMbo</code> such as
<code>$param_classes</code>, <code>$packages</code>,
<code>$properties</code> are automatically determined based on the
choice of the <code>loop_function</code>, <code>surrogate</code>,
<code>acq_function</code>, <code>acq_optimizer</code>, and
<code>result_assigner</code>.</p>
<p>If arguments such as the <code>surrogate</code>,
<code>acq_function</code>, <code>acq_optimizer</code> and
<code>result_assigner</code> were not fully initialized during
construction, e.g., the <code>surrogate</code> missing the
<code>archive</code>, or the <code>acq_function</code> missing the
<code>surrogate</code>, lazy initialization is completed prior to the
optimizer being used for optimization.</p>
<p>An object of class <code>OptimizerMbo</code> can be used to optimize
an object of class <a href="https://bbotk.mlr-org.com/reference/OptimInstanceSingleCrit.html"><code>OptimInstanceSingleCrit</code></a>
or <a href="https://bbotk.mlr-org.com/reference/OptimInstanceMultiCrit.html"><code>OptimInstanceMultiCrit</code></a>.</p>
<p>For hyperparameter optimization, <a href="https://mlr3mbo.mlr-org.com/reference/mlr_tuners_mbo.html"><code>TunerMbo</code></a>
should be used (which simply relies on an <code>OptimizerMbo</code> that
is constructed internally):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>tuner <span class="ot">=</span> TunerMbo<span class="sc">$</span><span class="fu">new</span>(bayesopt_ego,</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>mlr3misc<span class="sc">::</span><span class="fu">get_private</span>(tuner)[[<span class="st">&quot;.optimizer&quot;</span>]]</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="co">#&gt; &lt;OptimizerMbo&gt;: Model Based Optimization</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="co">#&gt; * Parameter classes: ParamLgl, ParamInt, ParamDbl</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="co">#&gt; * Properties: single-crit</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="co">#&gt; * Packages: mlr3mbo, mlr3, mlr3learners, DiceKriging, bbotk</span></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="co">#&gt; * Loop function: bayesopt_ego</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="co">#&gt; * Surrogate: LearnerRegrKM</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a><span class="co">#&gt; * Acquisition Function: AcqFunctionEI</span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a><span class="co">#&gt; * Acquisition Function Optimizer: (OptimizerRandomSearch |</span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a><span class="co">#&gt;   TerminatorEvals)</span></span></code></pre></div>
<div id="the-initial-design" class="section level2">
<h2>The Initial Design</h2>
<p><a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> offers two
different ways for specifying an initial design:</p>
<ol style="list-style-type: decimal">
<li>One can simply evaluate points on the <code>OptimInstance</code>
that is to be optimized prior to using an <code>OptimizerMbo</code>. In
this case, the <code>loop_function</code> should skip the construction
and evaluation of an initial design.</li>
<li>If no points were already evaluated on the
<code>OptimInstance</code>, the <code>loop_function</code> should
construct an initial design itself and evaluate it, e.g.,
<code>bayesopt_ego</code> then constructs an initial design of size
<span class="math inline">\(4D\)</span> where <span class="math inline">\(D\)</span> is the dimensionality of the search
space by sampling points uniformly at random.</li>
</ol>
<p>Functions for creating different initial designs are part of the <a href="https://paradox.mlr-org.com">paradox</a> package, e.g.:</p>
<ol style="list-style-type: decimal">
<li><a href="https://paradox.mlr-org.com/reference/generate_design_random.html"><code>generate_design_random</code></a>:
uniformly at random</li>
<li><a href="https://paradox.mlr-org.com/reference/generate_design_grid.html"><code>generate_design_grid</code></a>:
uniform sized grid</li>
<li><a href="https://paradox.mlr-org.com/reference/generate_design_lhs.html"><code>generate_design_lhs</code></a>:
Latin hypercube sampling</li>
<li><a href="https://paradox.mlr-org.com/reference/generate_design_sobol.html"><code>generate_design_sobol</code></a>:
Sobol sequence</li>
</ol>
</div>
</div>
<div id="defaults" class="section level1">
<h1>Defaults</h1>
<p><a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> tries to use
intelligent defaults for the <code>loop_function</code>,
<code>surrogate</code>, <code>acq_function</code>, and
<code>acq_optimizer</code> within <code>OptimizerMbo</code> and
<code>TunerMbo</code>.</p>
<p>For details, see <a href="https://mlr3mbo.mlr-org.com/reference/mbo_defaults.html"><code>mbo_defaults</code></a>.</p>
</div>
<div id="safety-nets" class="section level1">
<h1>Safety Nets</h1>
<p><a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> is quite stable in
the sense that - if desired - all kinds of errors can be caught and
handled appropriately within the <a href="https://mlr3mbo.mlr-org.com/reference/loop_function.html"><code>loop_function</code></a>.</p>
<p>As an example, let’s have a look at the inner workings of <a href="https://mlr3mbo.mlr-org.com/reference/mlr_loop_functions_ego.html"><code>bayesopt_ego</code></a>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="cf">repeat</span> {</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  xdt <span class="ot">=</span> <span class="fu">tryCatch</span>({</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>    .</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>    .</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>    .</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    acq_function<span class="sc">$</span>surrogate<span class="sc">$</span><span class="fu">update</span>()</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>    acq_function<span class="sc">$</span><span class="fu">update</span>()</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>    acq_optimizer<span class="sc">$</span><span class="fu">optimize</span>()</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  }, <span class="at">mbo_error =</span> <span class="cf">function</span>(mbo_error_condition) {</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>    lg<span class="sc">$</span><span class="fu">info</span>(<span class="fu">paste0</span>(<span class="fu">class</span>(mbo_error_condition), <span class="at">collapse =</span> <span class="st">&quot; / &quot;</span>))</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>    lg<span class="sc">$</span><span class="fu">info</span>(<span class="st">&quot;Proposing a randomly sampled point&quot;</span>)</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>    SamplerUnif<span class="sc">$</span><span class="fu">new</span>(domain)<span class="sc">$</span><span class="fu">sample</span>(1L)<span class="sc">$</span>data</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>  })</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>  .</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>  .</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>  .</span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>}</span></code></pre></div>
<p>In each iteration, a new candidate is chosen based on updating the
surrogate and acquisition function, and optimizing the acquisition
function. If any error happens during any of these steps, errors are
upgraded to errors of class <code>&quot;mbo_error&quot;</code> (and
<code>&quot;surrogate_update_error&quot;</code> for surrogate related errors as
well as <code>&quot;acq_optimizer_error&quot;</code> for acquisition function
optimization related errors). These errors are then caught and a
fallback is triggered: Evaluating the next candidate chosen uniformly at
random. Note that the same mechanism is actually also used to handle
random interleaving.</p>
<p>To illustrate this error handling mechanism, consider the following
scenario: We try to minimize <span class="math inline">\(f: [-1, 1]
\rightarrow \mathbb{R}, x \mapsto x^2\)</span>, however, our Gaussian
Process fails due to data points being too close to each other:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2906</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>domain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">x =</span> <span class="fu">p_dbl</span>(<span class="at">lower =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">1</span>))</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>codomain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">y =</span> <span class="fu">p_dbl</span>(<span class="at">tags =</span> <span class="st">&quot;minimize&quot;</span>))</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>objective_function <span class="ot">=</span> <span class="cf">function</span>(xs) {</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">y =</span> xs<span class="sc">$</span>x <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>}</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>objective <span class="ot">=</span> ObjectiveRFun<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>  <span class="at">fun =</span> objective_function,</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>  <span class="at">domain =</span> domain,</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>  <span class="at">codomain =</span> codomain)</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>instance <span class="ot">=</span> OptimInstanceSingleCrit<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>  <span class="at">objective =</span> objective,</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">10</span>))</span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>initial_design <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>instance<span class="sc">$</span><span class="fu">eval_batch</span>(initial_design)</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:27.780] [bbotk] Evaluating 4 configuration(s)</span></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:27.816] [bbotk] Result of batch 1:</span></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:27.823] [bbotk]  x y</span></span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:27.823] [bbotk]  1 1</span></span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:27.823] [bbotk]  1 1</span></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:27.823] [bbotk]  1 1</span></span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:27.823] [bbotk]  1 1</span></span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a>surrogate <span class="ot">=</span> <span class="fu">srlrn</span>(<span class="fu">lrn</span>(<span class="st">&quot;regr.km&quot;</span>,</span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a>  <span class="at">covtype =</span> <span class="st">&quot;matern3_2&quot;</span>,</span>
<span id="cb26-31"><a href="#cb26-31" tabindex="-1"></a>  <span class="at">optim.method =</span> <span class="st">&quot;gen&quot;</span>,</span>
<span id="cb26-32"><a href="#cb26-32" tabindex="-1"></a>  <span class="at">nugget.stability =</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>,</span>
<span id="cb26-33"><a href="#cb26-33" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb26-34"><a href="#cb26-34" tabindex="-1"></a>acq_function <span class="ot">=</span> <span class="fu">acqf</span>(<span class="st">&quot;ei&quot;</span>)</span>
<span id="cb26-35"><a href="#cb26-35" tabindex="-1"></a>acq_optimizer <span class="ot">=</span> <span class="fu">acqo</span>(<span class="fu">opt</span>(<span class="st">&quot;random_search&quot;</span>, <span class="at">batch_size =</span> <span class="dv">1000</span>),</span>
<span id="cb26-36"><a href="#cb26-36" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">1000</span>))</span>
<span id="cb26-37"><a href="#cb26-37" tabindex="-1"></a>optimizer <span class="ot">=</span> <span class="fu">opt</span>(<span class="st">&quot;mbo&quot;</span>,</span>
<span id="cb26-38"><a href="#cb26-38" tabindex="-1"></a>  <span class="at">loop_function =</span> bayesopt_ego,</span>
<span id="cb26-39"><a href="#cb26-39" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb26-40"><a href="#cb26-40" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb26-41"><a href="#cb26-41" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span>
<span id="cb26-42"><a href="#cb26-42" tabindex="-1"></a></span>
<span id="cb26-43"><a href="#cb26-43" tabindex="-1"></a>optimizer<span class="sc">$</span><span class="fu">optimize</span>(instance)</span>
<span id="cb26-44"><a href="#cb26-44" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:27.948] [bbotk] Starting to optimize 1 parameter(s) with &#39;&lt;OptimizerMbo&gt;&#39; and &#39;&lt;TerminatorEvals&gt; [n_evals=10, k=0]&#39;</span></span>
<span id="cb26-45"><a href="#cb26-45" tabindex="-1"></a><span class="co">#&gt; WARN  [11:13:27.994] [bbotk] missing value where TRUE/FALSE needed</span></span>
<span id="cb26-46"><a href="#cb26-46" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:27.995] [bbotk] surrogate_update_error / mbo_error / error / condition</span></span>
<span id="cb26-47"><a href="#cb26-47" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.002] [bbotk] Proposing a randomly sampled point</span></span>
<span id="cb26-48"><a href="#cb26-48" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.011] [bbotk] Evaluating 1 configuration(s)</span></span>
<span id="cb26-49"><a href="#cb26-49" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.014] [bbotk] Result of batch 2:</span></span>
<span id="cb26-50"><a href="#cb26-50" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.015] [bbotk]          x         y</span></span>
<span id="cb26-51"><a href="#cb26-51" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.015] [bbotk]  0.6742299 0.4545859</span></span>
<span id="cb26-52"><a href="#cb26-52" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.270] [bbotk] Evaluating 1 configuration(s)</span></span>
<span id="cb26-53"><a href="#cb26-53" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.274] [bbotk] Result of batch 3:</span></span>
<span id="cb26-54"><a href="#cb26-54" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.275] [bbotk]          x  x_domain     acq_ei .already_evaluated         y</span></span>
<span id="cb26-55"><a href="#cb26-55" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.275] [bbotk]  0.6686506 &lt;list[1]&gt; 0.04353973              FALSE 0.4470936</span></span>
<span id="cb26-56"><a href="#cb26-56" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.566] [bbotk] Evaluating 1 configuration(s)</span></span>
<span id="cb26-57"><a href="#cb26-57" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.570] [bbotk] Result of batch 4:</span></span>
<span id="cb26-58"><a href="#cb26-58" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.571] [bbotk]          x  x_domain    acq_ei .already_evaluated         y</span></span>
<span id="cb26-59"><a href="#cb26-59" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.571] [bbotk]  0.4553257 &lt;list[1]&gt; 0.0848473              FALSE 0.2073215</span></span>
<span id="cb26-60"><a href="#cb26-60" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.807] [bbotk] Evaluating 1 configuration(s)</span></span>
<span id="cb26-61"><a href="#cb26-61" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.811] [bbotk] Result of batch 5:</span></span>
<span id="cb26-62"><a href="#cb26-62" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.812] [bbotk]          x  x_domain    acq_ei .already_evaluated          y</span></span>
<span id="cb26-63"><a href="#cb26-63" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:28.812] [bbotk]  -0.242293 &lt;list[1]&gt; 0.1899698              FALSE 0.05870589</span></span>
<span id="cb26-64"><a href="#cb26-64" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.035] [bbotk] Evaluating 1 configuration(s)</span></span>
<span id="cb26-65"><a href="#cb26-65" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.039] [bbotk] Result of batch 6:</span></span>
<span id="cb26-66"><a href="#cb26-66" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.040] [bbotk]          x  x_domain     acq_ei .already_evaluated         y</span></span>
<span id="cb26-67"><a href="#cb26-67" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.040] [bbotk]  -0.998351 &lt;list[1]&gt; 0.09128581              FALSE 0.9967047</span></span>
<span id="cb26-68"><a href="#cb26-68" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.272] [bbotk] Evaluating 1 configuration(s)</span></span>
<span id="cb26-69"><a href="#cb26-69" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.275] [bbotk] Result of batch 7:</span></span>
<span id="cb26-70"><a href="#cb26-70" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.277] [bbotk]           x  x_domain     acq_ei .already_evaluated            y</span></span>
<span id="cb26-71"><a href="#cb26-71" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.277] [bbotk]  0.01617037 &lt;list[1]&gt; 0.09341134              FALSE 0.0002614808</span></span>
<span id="cb26-72"><a href="#cb26-72" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.280] [bbotk] Finished optimizing after 10 evaluation(s)</span></span>
<span id="cb26-73"><a href="#cb26-73" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.284] [bbotk] Result:</span></span>
<span id="cb26-74"><a href="#cb26-74" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.285] [bbotk]           x  x_domain            y</span></span>
<span id="cb26-75"><a href="#cb26-75" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.285] [bbotk]  0.01617037 &lt;list[1]&gt; 0.0002614808</span></span>
<span id="cb26-76"><a href="#cb26-76" tabindex="-1"></a><span class="co">#&gt;             x  x_domain            y</span></span>
<span id="cb26-77"><a href="#cb26-77" tabindex="-1"></a><span class="co">#&gt; 1: 0.01617037 &lt;list[1]&gt; 0.0002614808</span></span></code></pre></div>
<p>The log tells us that an error happened and was caught:
<code>&quot;surrogate_update_error / mbo_error / error / condition&quot;</code>.
We also see in the <code>archive</code> that the first candidate after
the initial design (the fifth point) was not proposed based on
optimizing the acquisition function (because the <code>&quot;acq_ei&quot;</code>
column is NA here):</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>instance<span class="sc">$</span>archive<span class="sc">$</span>data</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="co">#&gt;               x            y  x_domain           timestamp batch_nr     acq_ei</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="co">#&gt;  1:  1.00000000 1.0000000000 &lt;list[1]&gt; 2023-06-05 11:13:27        1         NA</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="co">#&gt;  2:  1.00000000 1.0000000000 &lt;list[1]&gt; 2023-06-05 11:13:27        1         NA</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="co">#&gt;  3:  1.00000000 1.0000000000 &lt;list[1]&gt; 2023-06-05 11:13:27        1         NA</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="co">#&gt;  4:  1.00000000 1.0000000000 &lt;list[1]&gt; 2023-06-05 11:13:27        1         NA</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="co">#&gt;  5:  0.67422986 0.4545859064 &lt;list[1]&gt; 2023-06-05 11:13:28        2         NA</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="co">#&gt;  6:  0.66865060 0.4470936288 &lt;list[1]&gt; 2023-06-05 11:13:28        3 0.04353973</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="co">#&gt;  7:  0.45532567 0.2073214654 &lt;list[1]&gt; 2023-06-05 11:13:28        4 0.08484730</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="co">#&gt;  8: -0.24229299 0.0587058937 &lt;list[1]&gt; 2023-06-05 11:13:28        5 0.18996976</span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="co">#&gt;  9: -0.99835097 0.9967046528 &lt;list[1]&gt; 2023-06-05 11:13:29        6 0.09128581</span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="co">#&gt; 10:  0.01617037 0.0002614808 &lt;list[1]&gt; 2023-06-05 11:13:29        7 0.09341134</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="co">#&gt;     .already_evaluated</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a><span class="co">#&gt;  1:                 NA</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a><span class="co">#&gt;  2:                 NA</span></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="co">#&gt;  3:                 NA</span></span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a><span class="co">#&gt;  4:                 NA</span></span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a><span class="co">#&gt;  5:                 NA</span></span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a><span class="co">#&gt;  6:              FALSE</span></span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a><span class="co">#&gt;  7:              FALSE</span></span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a><span class="co">#&gt;  8:              FALSE</span></span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a><span class="co">#&gt;  9:              FALSE</span></span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a><span class="co">#&gt; 10:              FALSE</span></span></code></pre></div>
<p>Nevertheless, due to the safety net, the BO loop eventually worked
just fine and did not simply throw an error.</p>
<p>If we set <code>catch_errors = FALSE</code> within the surrogate, we
see that the error was indeed caused by the surrogate:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>instance<span class="sc">$</span>archive<span class="sc">$</span><span class="fu">clear</span>()</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>instance<span class="sc">$</span><span class="fu">eval_batch</span>(initial_design)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.304] [bbotk] Evaluating 4 configuration(s)</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.310] [bbotk] Result of batch 1:</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.311] [bbotk]  x y</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.311] [bbotk]  1 1</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.311] [bbotk]  1 1</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.311] [bbotk]  1 1</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.311] [bbotk]  1 1</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>optimizer<span class="sc">$</span>surrogate<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>catch_errors <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>optimizer<span class="sc">$</span><span class="fu">optimize</span>(instance)</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a><span class="co">#&gt; INFO  [11:13:29.315] [bbotk] Starting to optimize 1 parameter(s) with &#39;&lt;OptimizerMbo&gt;&#39; and &#39;&lt;TerminatorEvals&gt; [n_evals=10, k=0]&#39;</span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a><span class="co">#&gt; Error in if (varinit.vario &lt;= 1e-20) varinit.vario &lt;- 1/2 * varinit.vario.total: missing value where TRUE/FALSE needed</span></span></code></pre></div>
<p>In case of the error belonging to the
<code>acq_optimizer_error</code> class, it is helpful to increase the
logging level of the acquisition function optimizer (e.g.,
<code>acq_optimizer$param_set$values$logging_level = &quot;info&quot;</code>) and
also set
<code>acq_optimizer$param_set$values$catch_errors = FALSE</code>. This
allows for straightforward debugging.</p>
<p>To make sure that your BO loop behaved as expected, always inspect
the log of the optimization process and inspect the <code>archive</code>
and check whether the acquisition function column is populated as
expected.</p>
</div>
<div id="writing-your-own-loop-function" class="section level1">
<h1>Writing Your Own Loop Function</h1>
<p>Writing a custom <code>loop_function</code> is straightforward.</p>
<p>Any <code>loop_function</code> must be an object of the S3 class <a href="https://mlr3mbo.mlr-org.com/reference/loop_function.html"><code>loop_function</code></a>
(simply a standard R function with some requirements regarding its
arguments and attributes). Arguments of the function must include
<code>instance</code>, <code>surrogate</code>,
<code>acq_function</code>, and <code>acq_optimizer</code> and attributes
must include <code>id</code> (id of the loop function),
<code>label</code> (brief description), <code>instance</code>
(“single-crit” and or “multi_crit”), and <code>man</code> (link to the
manual page).</p>
<p>Technically, any <code>loop_function</code> therefore looks like the
following:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>bayesopt_custom <span class="ot">=</span> <span class="cf">function</span>(instance, surrogate, acq_function, acq_optimizer) {</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  <span class="co"># typically some assertions</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  <span class="co"># initial design handling</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>  <span class="co"># actual loop function</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>}</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a><span class="fu">class</span>(bayesopt_custom) <span class="ot">=</span> <span class="st">&quot;loop_function&quot;</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="fu">attr</span>(bayesopt_custom, <span class="st">&quot;id&quot;</span>) <span class="ot">=</span> <span class="st">&quot;bayesopt_custom&quot;</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a><span class="fu">attr</span>(bayesopt_custom, <span class="st">&quot;label&quot;</span>) <span class="ot">=</span> <span class="st">&quot;My custom BO loop&quot;</span></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a><span class="fu">attr</span>(bayesopt_custom, <span class="st">&quot;instance&quot;</span>) <span class="ot">=</span> <span class="st">&quot;single-crit&quot;</span></span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a><span class="fu">attr</span>(bayesopt_custom, <span class="st">&quot;man&quot;</span>) <span class="ot">=</span> <span class="st">&quot;&quot;</span>  <span class="co"># no man page</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a><span class="co"># if you want to add it to the dictionary: mlr_loop_functions$add(&quot;bayesopt_custom&quot;, bayesopt_custom)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>bayesopt_custom</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="co">#&gt; Loop function: bayesopt_custom</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="co">#&gt; * Description: My custom BO loop</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="co">#&gt; * Supported Instance: single-crit</span></span></code></pre></div>
<p>For some inspiration on how to write actual meaningful
<code>loop_function</code>s, see, e.g., <a href="https://mlr3mbo.mlr-org.com/reference/mlr_loop_functions_ego.html"><code>bayesopt_ego</code></a>.</p>
</div>
<div id="examples" class="section level1">
<h1>Examples</h1>
<p>In this final section, some standard examples are provided.</p>
<div id="single-objective-2d-schwefel-function" class="section level2">
<h2>Single-Objective: 2D Schwefel Function</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>objective_function <span class="ot">=</span> <span class="cf">function</span>(xs) {</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">y =</span> <span class="fl">418.9829</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> (<span class="fu">sum</span>(<span class="fu">unlist</span>(xs) <span class="sc">*</span> <span class="fu">sin</span>(<span class="fu">sqrt</span>(<span class="fu">abs</span>(<span class="fu">unlist</span>(xs)))))))</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>}</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>domain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">x1 =</span> <span class="fu">p_dbl</span>(<span class="at">lower =</span> <span class="sc">-</span><span class="dv">500</span>, <span class="at">upper =</span> <span class="dv">500</span>),</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  <span class="at">x2 =</span> <span class="fu">p_dbl</span>(<span class="at">lower =</span> <span class="sc">-</span><span class="dv">500</span>, <span class="at">upper =</span> <span class="dv">500</span>))</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>codomain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">y =</span> <span class="fu">p_dbl</span>(<span class="at">tags =</span> <span class="st">&quot;minimize&quot;</span>))</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>objective <span class="ot">=</span> ObjectiveRFun<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>  <span class="at">fun =</span> objective_function,</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>  <span class="at">domain =</span> domain,</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>  <span class="at">codomain =</span> codomain)</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>instance <span class="ot">=</span> OptimInstanceSingleCrit<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>  <span class="at">objective =</span> objective,</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>  <span class="at">search_space =</span> domain,</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">60</span>))</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="co"># Gaussian Process, EI, DIRECT</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>surrogate <span class="ot">=</span> <span class="fu">srlrn</span>(<span class="fu">lrn</span>(<span class="st">&quot;regr.km&quot;</span>,</span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a>  <span class="at">covtype =</span> <span class="st">&quot;matern3_2&quot;</span>,</span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a>  <span class="at">optim.method =</span> <span class="st">&quot;gen&quot;</span>,</span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a>  <span class="at">nugget.stability =</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a>acq_function <span class="ot">=</span> <span class="fu">acqf</span>(<span class="st">&quot;ei&quot;</span>)</span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a>acq_optimizer <span class="ot">=</span> <span class="fu">acqo</span>(<span class="fu">opt</span>(<span class="st">&quot;nloptr&quot;</span>, <span class="at">algorithm =</span> <span class="st">&quot;NLOPT_GN_DIRECT_L&quot;</span>),</span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;stagnation&quot;</span>, <span class="at">threshold =</span> <span class="fl">1e-8</span>))</span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a>optimizer <span class="ot">=</span> <span class="fu">opt</span>(<span class="st">&quot;mbo&quot;</span>,</span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a>  <span class="at">loop_function =</span> bayesopt_ego,</span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span>
<span id="cb31-31"><a href="#cb31-31" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2906</span>)</span>
<span id="cb31-33"><a href="#cb31-33" tabindex="-1"></a>optimizer<span class="sc">$</span><span class="fu">optimize</span>(instance)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> batch_nr, <span class="at">y =</span> <span class="fu">cummin</span>(y)), <span class="at">data =</span> instance<span class="sc">$</span>archive<span class="sc">$</span>data) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>  <span class="fu">geom_step</span>() <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Batch Nr.&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Best y&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>xdt <span class="ot">=</span> <span class="fu">generate_design_grid</span>(instance<span class="sc">$</span>search_space, <span class="at">resolution =</span> <span class="dv">101</span>)<span class="sc">$</span>data</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>ydt <span class="ot">=</span> objective<span class="sc">$</span><span class="fu">eval_dt</span>(xdt)</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> y), <span class="at">data =</span> <span class="fu">cbind</span>(xdt, ydt)) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>  <span class="fu">geom_contour_filled</span>() <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> batch_nr), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">data =</span> instance<span class="sc">$</span>archive<span class="sc">$</span>data) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">&quot;lightgrey&quot;</span>, <span class="at">high =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
</div>
<div id="multi-objective-schaffer-function-n.-1" class="section level2">
<h2>Multi-Objective: Schaffer Function N. 1</h2>
<div id="parego" class="section level3">
<h3>ParEGO</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>objective_function <span class="ot">=</span> <span class="cf">function</span>(xs) {</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">y1 =</span> xs<span class="sc">$</span>x<span class="sc">^</span><span class="dv">2</span>, <span class="at">y2 =</span> (xs<span class="sc">$</span>x <span class="sc">-</span> <span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>}</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>domain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">x =</span> <span class="fu">p_dbl</span>(<span class="at">lower =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">upper =</span> <span class="dv">10</span>))</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>codomain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">y1 =</span> <span class="fu">p_dbl</span>(<span class="at">tags =</span> <span class="st">&quot;minimize&quot;</span>), <span class="at">y2 =</span> <span class="fu">p_dbl</span>(<span class="at">tags =</span> <span class="st">&quot;minimize&quot;</span>))</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>objective <span class="ot">=</span> ObjectiveRFun<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>  <span class="at">fun =</span> objective_function,</span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a>  <span class="at">domain =</span> domain,</span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a>  <span class="at">codomain =</span> codomain)</span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>instance <span class="ot">=</span> OptimInstanceMultiCrit<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a>  <span class="at">objective =</span> objective,</span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a>  <span class="at">search_space =</span> domain,</span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">30</span>))</span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a><span class="co"># Gaussian Process, EI, DIRECT</span></span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a>surrogate <span class="ot">=</span> <span class="fu">srlrn</span>(<span class="fu">lrn</span>(<span class="st">&quot;regr.km&quot;</span>,</span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a>  <span class="at">covtype =</span> <span class="st">&quot;matern3_2&quot;</span>,</span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a>  <span class="at">optim.method =</span> <span class="st">&quot;gen&quot;</span>,</span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a>  <span class="at">nugget.stability =</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>,</span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a>acq_function <span class="ot">=</span> <span class="fu">acqf</span>(<span class="st">&quot;ei&quot;</span>)</span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a>acq_optimizer <span class="ot">=</span> <span class="fu">acqo</span>(<span class="fu">opt</span>(<span class="st">&quot;nloptr&quot;</span>, <span class="at">algorithm =</span> <span class="st">&quot;NLOPT_GN_DIRECT_L&quot;</span>),</span>
<span id="cb34-25"><a href="#cb34-25" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;stagnation&quot;</span>, <span class="at">threshold =</span> <span class="fl">1e-8</span>))</span>
<span id="cb34-26"><a href="#cb34-26" tabindex="-1"></a>optimizer <span class="ot">=</span> <span class="fu">opt</span>(<span class="st">&quot;mbo&quot;</span>,</span>
<span id="cb34-27"><a href="#cb34-27" tabindex="-1"></a>  <span class="at">loop_function =</span> bayesopt_parego,</span>
<span id="cb34-28"><a href="#cb34-28" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb34-29"><a href="#cb34-29" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb34-30"><a href="#cb34-30" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span>
<span id="cb34-31"><a href="#cb34-31" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2906</span>)</span>
<span id="cb34-33"><a href="#cb34-33" tabindex="-1"></a>optimizer<span class="sc">$</span><span class="fu">optimize</span>(instance)</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> y1, <span class="at">y =</span> y2), <span class="at">data =</span> instance<span class="sc">$</span>archive<span class="sc">$</span><span class="fu">best</span>()) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">library</span>(emoa)</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a><span class="fu">library</span>(mlr3misc)</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>anytime_hypervolume <span class="ot">=</span> <span class="fu">map_dtr</span>(<span class="fu">unique</span>(instance<span class="sc">$</span>archive<span class="sc">$</span>data<span class="sc">$</span>batch_nr), <span class="cf">function</span>(bnr) {</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>  pareto <span class="ot">=</span> instance<span class="sc">$</span>archive<span class="sc">$</span><span class="fu">best</span>(<span class="at">batch =</span> <span class="dv">1</span><span class="sc">:</span>bnr)[, instance<span class="sc">$</span>archive<span class="sc">$</span>cols_y, with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>  dhv <span class="ot">=</span> <span class="fu">dominated_hypervolume</span>(<span class="fu">t</span>(pareto), <span class="at">ref =</span> <span class="fu">t</span>(<span class="fu">t</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">144</span>))))</span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>  <span class="fu">data.table</span>(<span class="at">batch_nr =</span> bnr, <span class="at">dhv =</span> dhv)</span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>})</span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> batch_nr, <span class="at">y =</span> dhv), <span class="at">data =</span> anytime_hypervolume[batch_nr <span class="sc">&gt;</span> <span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">direction =</span> <span class="st">&quot;vh&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Batch Nr.&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Dominated Hypervolume&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
</div>
<div id="sms-ego" class="section level3">
<h3>SMS-EGO</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>objective_function <span class="ot">=</span> <span class="cf">function</span>(xs) {</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">y1 =</span> xs<span class="sc">$</span>x<span class="sc">^</span><span class="dv">2</span>, <span class="at">y2 =</span> (xs<span class="sc">$</span>x <span class="sc">-</span> <span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>}</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>domain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">x =</span> <span class="fu">p_dbl</span>(<span class="at">lower =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">upper =</span> <span class="dv">10</span>))</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>codomain <span class="ot">=</span> <span class="fu">ps</span>(<span class="at">y1 =</span> <span class="fu">p_dbl</span>(<span class="at">tags =</span> <span class="st">&quot;minimize&quot;</span>), <span class="at">y2 =</span> <span class="fu">p_dbl</span>(<span class="at">tags =</span> <span class="st">&quot;minimize&quot;</span>))</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>objective <span class="ot">=</span> ObjectiveRFun<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>  <span class="at">fun =</span> objective_function,</span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>  <span class="at">domain =</span> domain,</span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>  <span class="at">codomain =</span> codomain)</span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>instance <span class="ot">=</span> OptimInstanceMultiCrit<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>  <span class="at">objective =</span> objective,</span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>  <span class="at">search_space =</span> domain,</span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">30</span>))</span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a><span class="co"># Gaussian Processes, SMS-EGO, DIRECT</span></span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a>learner_y1 <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.km&quot;</span>,</span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a>  <span class="at">covtype =</span> <span class="st">&quot;matern3_2&quot;</span>,</span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a>  <span class="at">optim.method =</span> <span class="st">&quot;gen&quot;</span>,</span>
<span id="cb37-21"><a href="#cb37-21" tabindex="-1"></a>  <span class="at">nugget.stability =</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">8</span>,</span>
<span id="cb37-22"><a href="#cb37-22" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="cn">FALSE</span>))</span>
<span id="cb37-23"><a href="#cb37-23" tabindex="-1"></a>learner_y2 <span class="ot">=</span> learner_y1<span class="sc">$</span><span class="fu">clone</span>(<span class="at">deep =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-24"><a href="#cb37-24" tabindex="-1"></a>surrogate <span class="ot">=</span> <span class="fu">srlrn</span>(<span class="fu">list</span>(learner_y1, learner_y2))</span>
<span id="cb37-25"><a href="#cb37-25" tabindex="-1"></a>acq_function <span class="ot">=</span> <span class="fu">acqf</span>(<span class="st">&quot;smsego&quot;</span>)</span>
<span id="cb37-26"><a href="#cb37-26" tabindex="-1"></a>acq_optimizer <span class="ot">=</span> <span class="fu">acqo</span>(<span class="fu">opt</span>(<span class="st">&quot;nloptr&quot;</span>, <span class="at">algorithm =</span> <span class="st">&quot;NLOPT_GN_DIRECT_L&quot;</span>),</span>
<span id="cb37-27"><a href="#cb37-27" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;stagnation&quot;</span>, <span class="at">threshold =</span> <span class="fl">1e-8</span>))</span>
<span id="cb37-28"><a href="#cb37-28" tabindex="-1"></a>optimizer <span class="ot">=</span> <span class="fu">opt</span>(<span class="st">&quot;mbo&quot;</span>,</span>
<span id="cb37-29"><a href="#cb37-29" tabindex="-1"></a>  <span class="at">loop_function =</span> bayesopt_smsego,</span>
<span id="cb37-30"><a href="#cb37-30" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb37-31"><a href="#cb37-31" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb37-32"><a href="#cb37-32" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span>
<span id="cb37-33"><a href="#cb37-33" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2906</span>)</span>
<span id="cb37-35"><a href="#cb37-35" tabindex="-1"></a>optimizer<span class="sc">$</span><span class="fu">optimize</span>(instance)</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> y1, <span class="at">y =</span> y2), <span class="at">data =</span> instance<span class="sc">$</span>archive<span class="sc">$</span><span class="fu">best</span>()) <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>anytime_hypervolume <span class="ot">=</span> <span class="fu">map_dtr</span>(<span class="fu">unique</span>(instance<span class="sc">$</span>archive<span class="sc">$</span>data<span class="sc">$</span>batch_nr), <span class="cf">function</span>(bnr) {</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>  pareto <span class="ot">=</span> instance<span class="sc">$</span>archive<span class="sc">$</span><span class="fu">best</span>(<span class="at">batch =</span> <span class="dv">1</span><span class="sc">:</span>bnr)[, instance<span class="sc">$</span>archive<span class="sc">$</span>cols_y, with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>  dhv <span class="ot">=</span> <span class="fu">dominated_hypervolume</span>(<span class="fu">t</span>(pareto), <span class="at">ref =</span> <span class="fu">t</span>(<span class="fu">t</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">144</span>))))</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a>  <span class="fu">data.table</span>(<span class="at">batch_nr =</span> bnr, <span class="at">dhv =</span> dhv)</span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>})</span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> batch_nr, <span class="at">y =</span> dhv), <span class="at">data =</span> anytime_hypervolume[batch_nr <span class="sc">&gt;</span> <span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a>  <span class="fu">geom_step</span>(<span class="at">direction =</span> <span class="st">&quot;vh&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Batch Nr.&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Dominated Hypervolume&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
</div>
</div>
<div id="single-objective-hpo" class="section level2">
<h2>Single-Objective HPO</h2>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>task <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">&quot;wine&quot;</span>)</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;classif.rpart&quot;</span>,</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>  <span class="at">cp =</span> <span class="fu">to_tune</span>(<span class="at">lower =</span> <span class="fl">1e-4</span>, <span class="at">upper =</span> <span class="dv">1</span>, <span class="at">logscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>  <span class="at">maxdepth =</span> <span class="fu">to_tune</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">10</span>),</span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>  <span class="at">minbucket =</span> <span class="fu">to_tune</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">10</span>),</span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a>  <span class="at">minsplit =</span> <span class="fu">to_tune</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">10</span>))</span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a>resampling <span class="ot">=</span> <span class="fu">rsmp</span>(<span class="st">&quot;cv&quot;</span>, <span class="at">folds =</span> <span class="dv">3</span>)</span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">&quot;classif.acc&quot;</span>)</span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a>instance <span class="ot">=</span> TuningInstanceSingleCrit<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a>  <span class="at">task =</span> task,</span>
<span id="cb40-13"><a href="#cb40-13" tabindex="-1"></a>  <span class="at">learner =</span> learner,</span>
<span id="cb40-14"><a href="#cb40-14" tabindex="-1"></a>  <span class="at">resampling =</span> resampling,</span>
<span id="cb40-15"><a href="#cb40-15" tabindex="-1"></a>  <span class="at">measure =</span> measure,</span>
<span id="cb40-16"><a href="#cb40-16" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">30</span>))</span>
<span id="cb40-17"><a href="#cb40-17" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" tabindex="-1"></a><span class="co"># Gaussian Process, EI, FocusSearch</span></span>
<span id="cb40-19"><a href="#cb40-19" tabindex="-1"></a>surrogate <span class="ot">=</span> <span class="fu">srlrn</span>(<span class="fu">lrn</span>(<span class="st">&quot;regr.km&quot;</span>,</span>
<span id="cb40-20"><a href="#cb40-20" tabindex="-1"></a>  <span class="at">covtype =</span> <span class="st">&quot;matern3_2&quot;</span>,</span>
<span id="cb40-21"><a href="#cb40-21" tabindex="-1"></a>  <span class="at">optim.method =</span> <span class="st">&quot;gen&quot;</span>,</span>
<span id="cb40-22"><a href="#cb40-22" tabindex="-1"></a>  <span class="at">nugget.estim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb40-23"><a href="#cb40-23" tabindex="-1"></a>  <span class="at">jitter =</span> <span class="fl">1e-12</span>,</span>
<span id="cb40-24"><a href="#cb40-24" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb40-25"><a href="#cb40-25" tabindex="-1"></a>acq_function <span class="ot">=</span> <span class="fu">acqf</span>(<span class="st">&quot;ei&quot;</span>)</span>
<span id="cb40-26"><a href="#cb40-26" tabindex="-1"></a>acq_optimizer <span class="ot">=</span> <span class="fu">acqo</span>(<span class="fu">opt</span>(<span class="st">&quot;focus_search&quot;</span>, <span class="at">n_points =</span> 100L, <span class="at">maxit =</span> <span class="dv">9</span>),</span>
<span id="cb40-27"><a href="#cb40-27" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">3000</span>))</span>
<span id="cb40-28"><a href="#cb40-28" tabindex="-1"></a>tuner <span class="ot">=</span> <span class="fu">tnr</span>(<span class="st">&quot;mbo&quot;</span>,</span>
<span id="cb40-29"><a href="#cb40-29" tabindex="-1"></a>  <span class="at">loop_function =</span> bayesopt_ego,</span>
<span id="cb40-30"><a href="#cb40-30" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb40-31"><a href="#cb40-31" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb40-32"><a href="#cb40-32" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span>
<span id="cb40-33"><a href="#cb40-33" tabindex="-1"></a></span>
<span id="cb40-34"><a href="#cb40-34" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2906</span>)</span>
<span id="cb40-35"><a href="#cb40-35" tabindex="-1"></a>tuner<span class="sc">$</span><span class="fu">optimize</span>(instance)</span>
<span id="cb40-36"><a href="#cb40-36" tabindex="-1"></a>instance<span class="sc">$</span>result</span></code></pre></div>
</div>
<div id="multi-objective-hpo" class="section level2">
<h2>Multi-Objective HPO</h2>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>task <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">&quot;wine&quot;</span>)</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;classif.rpart&quot;</span>,</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>  <span class="at">cp =</span> <span class="fu">to_tune</span>(<span class="at">lower =</span> <span class="fl">1e-4</span>, <span class="at">upper =</span> <span class="dv">1</span>, <span class="at">logscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>  <span class="at">maxdepth =</span> <span class="fu">to_tune</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">10</span>),</span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>  <span class="at">minbucket =</span> <span class="fu">to_tune</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">10</span>),</span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>  <span class="at">minsplit =</span> <span class="fu">to_tune</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">10</span>))</span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>resampling <span class="ot">=</span> <span class="fu">rsmp</span>(<span class="st">&quot;cv&quot;</span>, <span class="at">folds =</span> <span class="dv">3</span>)</span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">&quot;classif.acc&quot;</span>, <span class="st">&quot;selected_features&quot;</span>))</span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a>instance <span class="ot">=</span> TuningInstanceMultiCrit<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb41-11"><a href="#cb41-11" tabindex="-1"></a>  <span class="at">task =</span> task,</span>
<span id="cb41-12"><a href="#cb41-12" tabindex="-1"></a>  <span class="at">learner =</span> learner,</span>
<span id="cb41-13"><a href="#cb41-13" tabindex="-1"></a>  <span class="at">resampling =</span> resampling,</span>
<span id="cb41-14"><a href="#cb41-14" tabindex="-1"></a>  <span class="at">measures =</span> measures,</span>
<span id="cb41-15"><a href="#cb41-15" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">30</span>),</span>
<span id="cb41-16"><a href="#cb41-16" tabindex="-1"></a>  <span class="at">store_models =</span> <span class="cn">TRUE</span>) <span class="co"># required due to selected features</span></span>
<span id="cb41-17"><a href="#cb41-17" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" tabindex="-1"></a><span class="co"># Gaussian Process, EI, FocusSearch</span></span>
<span id="cb41-19"><a href="#cb41-19" tabindex="-1"></a>surrogate <span class="ot">=</span> <span class="fu">srlrn</span>(<span class="fu">lrn</span>(<span class="st">&quot;regr.km&quot;</span>,</span>
<span id="cb41-20"><a href="#cb41-20" tabindex="-1"></a>  <span class="at">covtype =</span> <span class="st">&quot;matern3_2&quot;</span>,</span>
<span id="cb41-21"><a href="#cb41-21" tabindex="-1"></a>  <span class="at">optim.method =</span> <span class="st">&quot;gen&quot;</span>,</span>
<span id="cb41-22"><a href="#cb41-22" tabindex="-1"></a>  <span class="at">nugget.estim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-23"><a href="#cb41-23" tabindex="-1"></a>  <span class="at">jitter =</span> <span class="fl">1e-12</span>,</span>
<span id="cb41-24"><a href="#cb41-24" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb41-25"><a href="#cb41-25" tabindex="-1"></a>acq_function <span class="ot">=</span> <span class="fu">acqf</span>(<span class="st">&quot;ei&quot;</span>)</span>
<span id="cb41-26"><a href="#cb41-26" tabindex="-1"></a>acq_optimizer <span class="ot">=</span> <span class="fu">acqo</span>(<span class="fu">opt</span>(<span class="st">&quot;focus_search&quot;</span>, <span class="at">n_points =</span> 100L, <span class="at">maxit =</span> <span class="dv">9</span>),</span>
<span id="cb41-27"><a href="#cb41-27" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">3000</span>))</span>
<span id="cb41-28"><a href="#cb41-28" tabindex="-1"></a>tuner <span class="ot">=</span> <span class="fu">tnr</span>(<span class="st">&quot;mbo&quot;</span>,</span>
<span id="cb41-29"><a href="#cb41-29" tabindex="-1"></a>  <span class="at">loop_function =</span> bayesopt_parego,</span>
<span id="cb41-30"><a href="#cb41-30" tabindex="-1"></a>  <span class="at">surrogate =</span> surrogate,</span>
<span id="cb41-31"><a href="#cb41-31" tabindex="-1"></a>  <span class="at">acq_function =</span> acq_function,</span>
<span id="cb41-32"><a href="#cb41-32" tabindex="-1"></a>  <span class="at">acq_optimizer =</span> acq_optimizer)</span>
<span id="cb41-33"><a href="#cb41-33" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2906</span>)</span>
<span id="cb41-35"><a href="#cb41-35" tabindex="-1"></a>tuner<span class="sc">$</span><span class="fu">optimize</span>(instance)</span>
<span id="cb41-36"><a href="#cb41-36" tabindex="-1"></a>instance<span class="sc">$</span>result</span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bischl_2021" class="csl-entry">
Bischl, Bernd, Martin Binder, Michel Lang, Tobias Pielok, Jakob Richter,
Stefan Coors, Janek Thomas, et al. 2023. <span>“Hyperparameter
Optimization: Foundations, Algorithms, Best Practices, and Open
Challenges.”</span> <em>Wiley Interdisciplinary Reviews: Data Mining and
Knowledge Discovery</em>, e1484.
</div>
<div id="ref-mlr3book" class="csl-entry">
Bischl, Bernd, Raphael Sonabend, Lars Kotthoff, and Michel Lang, eds.
2023. <em><span class="nocase">Flexible and Robust Machine Learning
Using mlr3 in R</span></em>. <a href="https://mlr3book.mlr-org.com">https://mlr3book.mlr-org.com</a>.
</div>
<div id="ref-garnett_2022" class="csl-entry">
Garnett, Roman. 2022. <em><span>Bayesian Optimization</span></em>.
Cambridge University Press. <a href="https://bayesoptbook.com/">https://bayesoptbook.com/</a>.
</div>
<div id="ref-jones_1998" class="csl-entry">
Jones, Donald R., Matthias Schonlau, and William J. Welch. 1998.
<span>“Efficient Global Optimization of Expensive Black-Box
Functions.”</span> <em>Journal of Global Optimization</em> 13 (4):
455–92. <a href="https://doi.org/10.1023/A:1008306431147">https://doi.org/10.1023/A:1008306431147</a>.
</div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
